@using HMS.ViewModels
@model HMS.ViewModels.CreateBillViewModel

@{
    ViewBag.Title = "Create Bill";
}

<section class="content">

    @using (Html.BeginForm("Create", "PatientsBill", new { PatientAppointmentID = Request.QueryString["Appointment_id"] }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="container-fluid">
            <div class="block-header">
                <h2>Generate Bill</h2>
            </div>
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card">
                        <div class="body">
                            <div class="row clearfix">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group form-line">
                                        @*@Html.TextBoxFor(m => m.PatientAppointmentID, new { @style = "display: none;", @type = "Text", @Value = Session["QueryVal"], @class = "form-control", @id = "PatientAptID", @required = "required" })*@
                                        @{
                                            if (Session["QueryVal"] == null)
                                            {
                                                <div class="drop-custum">
                                                    @Html.DropDownListFor(m => m.PatientAppointmentID, ViewData["Appointments"] as List<SelectListItem>, "Select Role", new { @class = "form-control show-tick" })
                                                </div>
                                            }
                                            else
                                            {
                                                @Html.TextBoxFor(m => m.PatientAppointmentID, new { @style = "display: none;", @type = "Text", @Value = Session["QueryVal"], @class = "form-control", @id = "PatientAptID", @required = "required" })
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="row clearfix">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group">
                                        <div class="form-line">
                                            @Html.TextBoxFor(m => m.Amount, new { @type = "Text", @class = "form-control", @id = "Amount", @placeholder = "Amount", @required = "required" })
                                            @Html.ValidationMessageFor(m => m.Amount, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row clearfix">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <div class="form-group">
                                        <div class="form-line">
                                            @Html.TextBoxFor(m => m.Description, new { @type = "Text", @class = "form-control", @id = "Description", @placeholder = "Description", @required = "required" })
                                            @Html.ValidationMessageFor(m => m.Description, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row clearfix">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <input type="submit" id="btnInsert" class="btn btn-raised g-bg-cyan waves-effect" value="Insert" name="nameValueInsert" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="test-Div">
            <div class="row clearfix">
                <div class="container-fluid">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="block-header">
                            <h2>Bill Enteries</h2>
                        </div>
                        <div class="card">
                            <div class="body table-responsive">
                                <table id="tblBills" class="table table-bordered table-striped table-hover js-basic-example dataTable" id="testing">

                                    <thead>
                                        <tr>
                                            <th>Patient Appointmnet ID</th>
                                            @*<th>Bill No</th>*@
                                            <th>Amount</th>
                                            <th>Description</th>
                                            @*<th></th>*@
                                        </tr>
                                    </thead>
                                    <tbody>

                                        @{
                                            double? AmountTotal = 0;
                                            if (Session["templist"] != null)
                                            {
                                                List<PatientViewModel> lst = (List<PatientViewModel>)Session["templist"];


                                                foreach (var o in lst)
                                                {
                                                    <tr>
                                                        <td><span>@o.PatientAppointmentID</span></td>
                                                        @*<td>@o.BillNo</td>*@
                                                        <td><span>@o.Amount</span></td>
                                                        <td><span>@o.Description</span></td>
                                                        @*<td>
                                                                <a class="Delete" href="javascript:;">Delete</a>
                                                            </td>*@
                                                    </tr>
                                                    AmountTotal += @o.Amount;
                                                }
                                            }
                                            else
                                            {
                                                <tr>
                                                    <td colspan="4">No Data Found</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div class="row clearfix">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="card">
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <div class="form-line">
                                        @*@Html.LabelFor(m => m.Note, "General Note")*@
                                        @{ Html.EnableClientValidation(false); }
                                        @Html.TextBoxFor(m => m.Note, new { @type = "Text", @class = "form-control", @id = "Note", @placeholder = "General Note" })
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <div class="form-line">
                                        @{ Html.EnableClientValidation(false); }
                                        @Html.TextBoxFor(m => m.Discount, new { @type = "Text", @class = "form-control", @id = "Discount", @placeholder = "Discount(if any)" })
                                    </div>
                                </div>
                            </div>
                            @Html.TextBoxFor(m => m.CreatedAt, new { @style = "display: none;", @type = "Text", @Value = DateTime.UtcNow, @class = "form-control", @id = "CreatedAt", @required = "required" })
                            @Html.TextBoxFor(m => m.AmountTotal, new { @style = "display: none;", @type = "Text", @Value = @AmountTotal, @class = "form-control", @id = "AmountTotal", @required = "required" })
                            <div class="row clearfix">
                                <div class="col-sm-6 col-md-6 col-lg-6">
                                    <input type="submit" id="buttonSubmit" class="btn btn-raised g-bg-cyan waves-effect" value="Submit" name="nameValueSubmit" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</section>

@*<script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>*@
@*<script type="text/javascript">
        //Delete event handler.
        //$("body").on("click", "#tblBills .Delete", function () {
        //    if (confirm("Do you want to delete this row?")) {
        //        var row = $(this).closest("tr");
        //        var AppointId = row.find("span").html();
        //        $.ajax({
        //            type: "POST",
        //            url: "/Session_Delete",
        //            data: '{AppointmentId: ' + AppointId + '}',
        //            contentType: "application/json; charset=utf-8",
        //            dataType: "json",
        //            success: function (response) {
        //                //  debugger;
        //                if ($("#tblBills tr").length > 2) {
        //                    row.remove();
        //                } else {
        //                    row.find(".Delete").hide();
        //                    row.find("span").html('&nbsp;');
        //                }
        //            }
        //        });
        //    }
        //});

        //function SessionDelete(id) {
        //    $.ajax({
        //        type: "POST",
        //        url: "/Session_Delete",
        //        data: '{AppointmenttId: ' + id + '}',
        //        contentType: "application/json; charset=utf-8",
        //        dataType: "json",
        //        success: function (response) {
        //            debugger;
        //            if ($("#testing tr").length > 2) {
        //                row.remove();
        //            }
        //        }
        //    });
        //}
    </script>
    @*<script>
            $("#btnInsert").on("click", function () {
                $("#test-Div").css("display", "block")
            });

        </script>*@



























